#N canvas 0 0 1200 900 12;

#X text 50 20 MVP SAMPLER - Load + Play + Pitch + ADSR + Filter;
#X text 50 40 All external controls via [r sampler-...];

#X comment 50 80 400 20 0 0 0 0 ===== EXTERNAL INPUTS =====;

#X obj 50 110 r sampler-load;
#X obj 50 140 r sampler-play;
#X obj 50 170 r sampler-pitch;
#X obj 200 110 r sampler-env-attack;
#X obj 200 140 r sampler-env-decay;
#X obj 200 170 r sampler-env-sustain;
#X obj 200 200 r sampler-env-release;
#X obj 350 110 r sampler-filter-cutoff;
#X obj 350 140 r sampler-filter-resonance;
#X obj 500 110 r sampler-main-pitch;
#X obj 500 140 r sampler-speed;

#X comment 50 250 400 20 0 0 0 0 ===== SAMPLE TABLE & LOADING =====;

#X obj 50 280 table sampler-table 441000;
#X obj 50 320 soundfiler;

#X msg 50 350 read \$1 sampler-table;

#X connect 0 0 14 0;
#X connect 14 0 15 0;
#X connect 15 0 16 0;

#X comment 50 420 400 20 0 0 0 0 ===== PLAYBACK ENGINE =====;

#X comment 50 460 200 20 0 0 0 0 Pitch Calculation (Note Pitch);
#X obj 50 490 expr pow(2 \, $f1 / 12);
#X obj 50 520 * 440;

#X comment 250 460 200 20 0 0 0 0 Main Pitch (Bonus);
#X obj 250 490 expr pow(2 \, $f1 / 12);
#X obj 250 520 * 1;

#X comment 450 460 200 20 0 0 0 0 Speed Multiplier (Bonus);
#X obj 450 490 * 1;

#X comment 50 600 200 20 0 0 0 0 Phase Generator;
#X obj 50 630 phasor~;
#X obj 50 660 *~ 1;
#X obj 50 690 tabread4~ sampler-table;

#X comment 50 780 200 20 0 0 0 0 ADSR Envelope;
#X obj 50 810 f 0;
#X obj 80 810 f 0;
#X obj 110 810 f 0;
#X obj 140 810 f 0;
#X obj 50 840 pack 0 0 0 0;
#X obj 50 870 vline~;

#X comment 200 780 200 20 0 0 0 0 Filter (LP);
#X obj 200 810 vcf~ 2;
#X obj 200 840 * 0.1;

#X comment 350 780 200 20 0 0 0 0 Output;
#X obj 350 810 *~;
#X obj 350 840 dac~;

#X comment 50 900 800 40 0 0 0 0 CONNECTIONS: [r sampler-play] triggers ADSR | [r sampler-pitch] + [r sampler-main-pitch] control phase | ADSR controls amplitude | [r sampler-filter-cutoff] controls filter cutoff | output to DAC;

#X connect 1 0 17 0;
#X connect 2 0 18 0;
#X connect 3 0 19 0;
#X connect 4 0 32 0;
#X connect 5 0 33 0;
#X connect 6 0 34 0;
#X connect 7 0 35 0;
#X connect 8 0 42 1;
#X connect 9 0 42 2;
#X connect 10 0 23 0;
#X connect 11 0 26 1;

#X connect 19 0 20 0;
#X connect 20 0 25 1;

#X connect 23 0 24 0;
#X connect 24 0 25 1;

#X connect 26 0 27 0;
#X connect 27 0 28 0;
#X connect 28 0 44 0;

#X connect 32 0 32 1;
#X connect 32 0 33 1;
#X connect 33 0 33 1;
#X connect 33 0 34 1;
#X connect 34 0 34 1;
#X connect 34 0 35 1;
#X connect 35 0 36 0;
#X connect 36 0 37 0;
#X connect 37 0 44 1;

#X connect 42 0 46 0;
#X connect 46 0 47 0;
#X connect 47 0 48 0;
#X connect 47 0 48 1;